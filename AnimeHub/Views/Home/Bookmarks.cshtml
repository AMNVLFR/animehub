@using System.Linq
@{
    ViewData["Title"] = "My Bookmarks";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>My Bookmarks</h1>
                @if (Model != null && Model.Count > 0)
                {
                    <span class="badge bg-anime fs-6">@Model.Count items</span>
                }
            </div>

            @if (Model != null && Model.Count > 0)
            {
                <div class="row">
                    @foreach (var item in Model)
                    {
                        <div class="col-md-4 mb-4">
                            <div class="anime-card h-100">
                                <a asp-action="Detail" asp-route-title="@item.Anime.Slug" class="text-decoration-none">
                                    <div class="card-img-placeholder">
                                        @if (!string.IsNullOrEmpty(item.Anime.CoverUrl))
                                        {
                                            <img src="@item.Anime.CoverUrl" alt="@item.Anime.Title" class="card-img-top">
                                        }
                                        else
                                        {
                                            <span class="placeholder-text">Anime Image</span>
                                        }
                                    </div>
                                    <div class="card-body p-3">
                                        <h6 class="card-title mb-2">@item.Anime.Title</h6>
                                        <div class="rating mb-2">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                if (i <= Math.Floor(item.Anime.Rating))
                                                {
                                                    <i class="fas fa-star text-warning"></i>
                                                }
                                                else if (i - 0.5 <= item.Anime.Rating)
                                                {
                                                    <i class="fas fa-star-half-alt text-warning"></i>
                                                }
                                                else
                                                {
                                                    <i class="far fa-star text-warning"></i>
                                                }
                                            }
                                            <span class="ms-2 text-muted">@item.Anime.Rating.ToString("0.0")</span>
                                        </div>
                                        <div class="anime-info mb-2">
                                            <small class="text-muted d-block">
                                                <i class="fas fa-calendar me-1"></i>@item.Anime.Year
                                                <span class="ms-2"><i class="fas fa-play-circle me-1"></i>@item.Anime.Status</span>
                                            </small>
                                            @{
                                                var genreNames = new List<string>();
                                                if (item.Anime.AnimeGenres != null)
                                                {
                                                    foreach (var ag in item.Anime.AnimeGenres)
                                                    {
                                                        if (ag.Genre != null)
                                                        {
                                                            genreNames.Add(ag.Genre.Name);
                                                        }
                                                    }
                                                }
                                            }
                                            @if (genreNames.Any())
                                            {
                                                <small class="text-muted d-block">
                                                    <i class="fas fa-tags me-1"></i>@string.Join(", ", genreNames)
                                                </small>
                                            }
                                        </div>
                                        <small class="text-muted">Bookmarked @item.AddedAt.ToString("MMM dd, yyyy")</small>
                                    </div>
                                </a>
                                <div class="card-footer p-2">
                                    <button class="btn btn-outline-danger btn-sm w-100 remove-from-bookmarks" data-anime-id="@item.AnimeId">
                                        <i class="fas fa-trash"></i> Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <div class="empty-state-icon mb-4">
                        <i class="fas fa-bookmark fa-5x text-anime opacity-50"></i>
                    </div>
                    <h3 class="text-muted mb-3">Your bookmarks are empty</h3>
                    <p class="text-muted mb-4">Bookmark anime to save them for later and never forget what you want to watch.</p>
                    <a asp-action="Index" class="btn btn-anime btn-lg">Browse Anime</a>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.remove-from-bookmarks').click(function() {
                var animeId = $(this).data('anime-id');
                var card = $(this).closest('.col-md-3');

                if (confirm('Remove this anime from your bookmarks?')) {
                    $.post('/Home/RemoveFromBookmarks', { animeId: animeId }, function(response) {
                        if (response.success) {
                            card.fadeOut(300, function() { $(this).remove(); });
                        } else {
                            alert('Error removing from bookmarks');
                        }
                    });
                }
            });
        });
    </script>
}